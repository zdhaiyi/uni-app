if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((n=>t.resolve(e()).then((()=>n))),(n=>t.resolve(e()).then((()=>{throw n}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e){return weex.requireModule(e)}function n(e,t,...n){uni.__log__?uni.__log__(e,t,...n):console[e].apply(console,[...n,t])}const a=(t,n=0)=>(n,a=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,n,a)},s=a("onHide",3),o=a("onLaunch",1),i=(e,t)=>{const n=e.__vccOpts||e;for(const[a,s]of t)n[a]=s;return n},c=i({__name:"uni-icons",props:{type:{type:String,default:""},size:{type:[Number,String],default:32},color:{type:String,default:"#333"}},setup:t=>(n,a)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["uni-icons",[t.type?"uni-icons-"+t.type:""]]),style:e.normalizeStyle({color:t.color,"font-size":t.size+"rpx"})},["compass"===t.type?(e.openBlock(),e.createElementBlock("text",{key:0},"ğŸ§­")):"chat"===t.type?(e.openBlock(),e.createElementBlock("text",{key:1},"ğŸ’¬")):"chatboxes"===t.type?(e.openBlock(),e.createElementBlock("text",{key:2},"ğŸ“¨")):"personadd"===t.type?(e.openBlock(),e.createElementBlock("text",{key:3},"ğŸ‘¤")):"camera"===t.type?(e.openBlock(),e.createElementBlock("text",{key:4},"ğŸ“·")):"person"===t.type?(e.openBlock(),e.createElementBlock("text",{key:5},"ğŸ‘¥")):"game"===t.type?(e.openBlock(),e.createElementBlock("text",{key:6},"ğŸ®")):"more"===t.type?(e.openBlock(),e.createElementBlock("text",{key:7},"â‹¯")):"refresh"===t.type?(e.openBlock(),e.createElementBlock("text",{key:8},"ğŸ”„")):(e.openBlock(),e.createElementBlock("text",{key:9},"â“"))],6))},[["__scopeId","data-v-8b6842e2"]]);const l=new class{constructor(){this.vpn=null,this.available=!1,this.inited=!1,this.isConnecting=!1,this.isConnected=!1,this.statusCb=null,this.timer=null,this.connectStartAt=0}_emit(e){if("function"==typeof this.statusCb)try{this.statusCb(e||{})}catch(t){n("error","at utils/android-vpn.js:20",t)}}async initialize(){if(this.inited)return this.available;try{if("android"!==uni.getSystemInfoSync().platform)return n("warn","at utils/android-vpn.js:32","[VPN] é Android å¹³å°ï¼Œè·³è¿‡åŸç”Ÿæ’ä»¶"),this.available=!1,this.inited=!0,!1;0,this.vpn=t("MyVpnPlugin"),this.available=!!this.vpn,this.available?"function"==typeof this.vpn.onVpnStatusUpdate&&this.vpn.onVpnStatusUpdate((e=>{const t=!(!e||!e.connected&&!e.isConnected),n=e&&(e.message||e.msg)||(t?"å·²è¿æ¥":"æœªè¿æ¥");this.isConnected=t,this.isConnecting=!1,this._emit({connected:t,status:t?"connected":"disconnected",message:n})})):n("warn","at utils/android-vpn.js:61","[VPN] æœªåŠ è½½åˆ°åŸç”Ÿæ’ä»¶ï¼Œå°†ä½¿ç”¨æ¨¡æ‹Ÿæ¨¡å¼")}catch(e){n("error","at utils/android-vpn.js:64","[VPN] åˆå§‹åŒ–å¤±è´¥ï¼š",e),this.available=!1}return this.inited=!0,this.available}onStatusUpdate(e){this.statusCb=e}offStatusUpdate(){this.statusCb=null}async getStatus(){if(this.inited||await this.initialize(),this.available&&"function"==typeof this.vpn.getVpnStatus)try{return await new Promise((e=>{this.vpn.getVpnStatus((t=>{const n=!(!t||!t.connected&&!t.isConnected);e({connected:n,status:n?"connected":"disconnected",message:t&&(t.message||t.msg)||(n?"å·²è¿æ¥":"æœªè¿æ¥")})}))}))}catch(e){}return{connected:this.isConnected,status:this.isConnected?"connected":this.isConnecting?"connecting":"disconnected",message:this.isConnected?"å·²è¿æ¥":"æœªè¿æ¥"}}async connect(e){if(this.inited||await this.initialize(),!e||!e.host||!e.port)throw new Error("èŠ‚ç‚¹ä¿¡æ¯ä¸å®Œæ•´");if(this.isConnecting)throw new Error("è¿æ¥ä¸­ï¼Œè¯·ç¨å€™");if(this.isConnected)throw new Error("å·²è¿æ¥ï¼Œè¯·å…ˆæ–­å¼€");const t={proxyType:"socks5",server:e.host,port:parseInt(e.port,10)||1080,username:e.account||"",password:e.password||"",authType:e.account&&e.password?"password":"none"};return this.isConnecting=!0,this._emit({connected:!1,status:"connecting",message:"è¿æ¥ä¸­..."}),this.available&&"function"==typeof this.vpn.startVpn?await new Promise(((e,n)=>{const a=setTimeout((()=>{this.isConnecting=!1,n(new Error("è¿æ¥è¶…æ—¶")),this._emit({connected:!1,status:"error",message:"è¿æ¥è¶…æ—¶"})}),3e4);try{this.vpn.startVpn(t,(t=>{clearTimeout(a),this.isConnecting=!1;const s=!(!t||!t.success);return this.isConnected=s,this.connectStartAt=s?Date.now():0,this._emit({connected:s,status:s?"connected":"error",message:t&&t.message||(s?"è¿æ¥æˆåŠŸ":"è¿æ¥å¤±è´¥")}),s?e(t):n(new Error(t&&t.message||"è¿æ¥å¤±è´¥"))}))}catch(s){clearTimeout(a),this.isConnecting=!1,this.isConnected=!1,this._emit({connected:!1,status:"error",message:s.message||"è¿æ¥å¼‚å¸¸"}),n(s)}})):await this._mockConnect()}async disconnect(){return this.available&&"function"==typeof this.vpn.stopVpn?await new Promise((e=>{try{this.vpn.stopVpn((t=>{this.isConnected=!1,this.isConnecting=!1,this.connectStartAt=0,this._emit({connected:!1,status:"disconnected",message:t&&t.message||"å·²æ–­å¼€"}),e(t||{success:!0})}))}catch(t){this.isConnected=!1,this.isConnecting=!1,this.connectStartAt=0,this._emit({connected:!1,status:"disconnected",message:"å·²æ–­å¼€"}),e({success:!0})}})):(clearInterval(this.timer),this.timer=null,this.isConnected=!1,this.isConnecting=!1,this.connectStartAt=0,this._emit({connected:!1,status:"disconnected",message:"å·²æ–­å¼€ï¼ˆæ¨¡æ‹Ÿï¼‰"}),{success:!0})}async _mockConnect(){return await new Promise((e=>{setTimeout((()=>{this.isConnecting=!1,this.isConnected=!0,this.connectStartAt=Date.now(),this._emit({connected:!0,status:"connected",message:"æ¨¡æ‹Ÿè¿æ¥æˆåŠŸ"}),clearInterval(this.timer),this.timer=setInterval((()=>{this.isConnected&&this._emit({connected:!0,status:"connected",message:"æ¨¡æ‹Ÿè¿è¡Œä¸­"})}),3e3),e({success:!0,message:"æ¨¡æ‹Ÿè¿æ¥æˆåŠŸ"})}),1e3)}))}},r=i({__name:"index",setup(t){const a=e.ref(!1),s=e.ref(""),o=e.ref(""),i=e.ref(!1),r=e.ref(!1),u=e.ref("æœªè¿æ¥"),d=e.ref("--"),p=e.ref("--"),m=e.ref("è¿æ¥VPN"),v=e.ref([]),h=e.ref(null),g=e.ref(1),y=e.ref(20),f=e.ref(!1);e.ref(!1);let w=null;const E=e.computed((()=>v.value.filter((e=>e.status&&!S(e))))),V=e.computed((()=>i.value?"connected":r.value?"connecting":"disconnected"));async function k(){if(a.value){if(!f.value){f.value=!0,uni.showLoading({title:"è·å–èŠ‚ç‚¹ä¸­..."});try{const e=await uni.request({url:"http://124.223.21.69/api/nodes",method:"GET",data:{page:g.value,pageSize:y.value},header:{Authorization:"Bearer "+o.value}});let t=[];Array.isArray(e.data)?t=e.data:e.data&&Array.isArray(e.data.nodes)?t=e.data.nodes:e.data&&Array.isArray(e.data.data)&&(t=e.data.data),v.value=(t||[]).map((e=>({...e})));const n=v.value.findIndex((e=>e.status&&!S(e)));h.value=-1!==n?n:v.value.length?0:null}catch(e){uni.showToast({title:"è·å–èŠ‚ç‚¹å¤±è´¥",icon:"none"}),n("error","at pages/index/index.vue:182",e)}finally{f.value=!1,uni.hideLoading()}}}else uni.showToast({title:"è¯·å…ˆç™»å½•",icon:"none"})}function S(e){return!!e.expire&&new Date(e.expire).getTime()<=Date.now()}function N(e){if(!e)return"æ— è¿‡æœŸ";const t=new Date(e),n=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0"),s=t.getDate().toString().padStart(2,"0"),o=t.getTime()-Date.now();if(o>0){const e=Math.ceil(o/864e5);if(e<=30)return`${e}å¤©åè¿‡æœŸ`}return`${n}-${a}-${s}`}function x(){a.value?uni.showModal({title:"ç¡®è®¤é€€å‡º",content:"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ",success:async({confirm:e})=>{e&&(i.value&&await _(),uni.removeStorageSync("token"),uni.removeStorageSync("username"),a.value=!1,o.value="",s.value="",v.value=[],h.value=null,uni.showToast({title:"å·²é€€å‡ºç™»å½•",icon:"success"}))}}):uni.navigateTo({url:"/pages/login/login"})}async function C(){r.value||(a.value?null!==h.value?i.value?await _():await async function(){const e=v.value[h.value];if(!e)return;if(!e.status||S(e))return void uni.showToast({title:"è¯¥èŠ‚ç‚¹ä¸å¯ç”¨",icon:"none"});r.value=!0,u.value="è¿æ¥ä¸­...",m.value="è¿æ¥ä¸­...";try{await l.connect(e)}catch(t){r.value=!1,i.value=!1,u.value="è¿æ¥å¤±è´¥",m.value="è¿æ¥VPN",uni.showToast({title:t.message||"è¿æ¥å¤±è´¥",icon:"none"})}}():uni.showToast({title:"è¯·é€‰æ‹©èŠ‚ç‚¹",icon:"none"}):uni.showToast({title:"è¯·å…ˆç™»å½•",icon:"none"}))}async function _(){try{await l.disconnect()}catch(e){uni.showToast({title:e.message||"æ–­å¼€å¤±è´¥",icon:"none"})}}function B(e){const t=!(!e||!e.connected&&!e.isConnected);if(i.value=t,r.value=!1,u.value=e&&e.message?e.message:t?"å·²è¿æ¥":"æœªè¿æ¥",m.value=t?"æ–­å¼€è¿æ¥":"è¿æ¥VPN",t&&null!==h.value){const e=v.value[h.value];d.value=`${e.tag} Â· ${e.host}:${e.port}`,w&&(clearInterval(w),w=null);let t=0;p.value="è¿æ¥æ—¶é—´: 00:00",w=setInterval((()=>{t++;const e=String(Math.floor(t/60)).padStart(2,"0"),n=String(t%60).padStart(2,"0");p.value=`è¿æ¥æ—¶é—´: ${e}:${n}`}),1e3)}else w&&(clearInterval(w),w=null),d.value="--",p.value="--";e&&"error"===e.status&&e.message&&uni.showToast({title:e.message,icon:"none"})}return e.onMounted((async()=>{!function(){const e=uni.getStorageSync("token"),t=uni.getStorageSync("username");e&&t&&(o.value=e,s.value=t,a.value=!0)}(),await l.initialize(),l.onStatusUpdate(B),a.value&&k()})),e.onUnmounted((()=>{l.offStatusUpdate(),w&&(clearInterval(w),w=null)})),(t,n)=>{const o=(l=e.resolveDynamicComponent("uni-icons"),g=c,"string"==typeof l?g:l);var l,g;return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"user-info"},[a.value?(e.openBlock(),e.createElementBlock("text",{key:0,class:"welcome-text"},"æ¬¢è¿, "+e.toDisplayString(s.value),1)):(e.openBlock(),e.createElementBlock("text",{key:1,class:"welcome-text"},"è¯·å…ˆç™»å½•")),e.createElementVNode("button",{class:"btn-auth",onClick:x},e.toDisplayString(a.value?"é€€å‡ºç™»å½•":"ç™»å½•"),1)])]),e.createElementVNode("view",{class:"vpn-status-card"},[e.createElementVNode("view",{class:"status-header"},[e.createElementVNode("view",{class:e.normalizeClass(["status-indicator",V.value])},null,2),e.createElementVNode("text",{class:"status-text"},e.toDisplayString(u.value),1)]),e.createElementVNode("view",{class:"connection-info"},e.toDisplayString(d.value),1),e.createElementVNode("view",{class:"connection-time"},e.toDisplayString(p.value),1),e.createElementVNode("button",{class:e.normalizeClass(["btn-connect",{connecting:r.value}]),onClick:C,disabled:!a.value||0===v.value.length||null===h.value},e.toDisplayString(m.value),11,["disabled"])]),e.createElementVNode("view",{class:"section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"èŠ‚ç‚¹åˆ—è¡¨"),e.createElementVNode("view",{class:"section-action",onClick:k},[e.createElementVNode("text",{class:"refresh-text"},"åˆ·æ–°"),e.createVNode(o,{type:"refresh",size:"16",color:"#4361ee"})])]),e.createElementVNode("view",{class:"nodes-stats"},[e.createElementVNode("text",{class:"stats-text"},"å¯ç”¨èŠ‚ç‚¹: "+e.toDisplayString(E.value.length)+"/"+e.toDisplayString(v.value.length),1)]),e.createElementVNode("scroll-view",{class:"node-list","scroll-y":""},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(v.value,((t,n)=>(e.openBlock(),e.createElementBlock("view",{key:t._id,class:e.normalizeClass(["node-item",{selected:h.value===n,offline:!t.status||S(t),"no-auth":!1}]),onClick:e=>function(e){const t=v.value[e];t&&(t.status&&!S(t)?(h.value=e,i.value&&(d.value=`${t.tag} Â· ${t.host}:${t.port}`)):uni.showToast({title:"è¯¥èŠ‚ç‚¹ä¸å¯ç”¨",icon:"none"}))}(n)},[e.createElementVNode("view",{class:"node-info"},[e.createElementVNode("view",{class:"node-details"},[e.createElementVNode("text",{class:"node-name"},e.toDisplayString(t.tag),1),e.createElementVNode("view",{class:"node-meta"},[e.createElementVNode("text",{class:"node-location"},e.toDisplayString(t.host)+":"+e.toDisplayString(t.port),1),e.createElementVNode("text",{class:"node-expire"},e.toDisplayString(N(t.expire)),1)])])]),e.createElementVNode("view",{class:"node-status"},[e.createElementVNode("view",{class:"status-indicators"},[e.createElementVNode("text",{class:e.normalizeClass(t.status?"status-online":"status-offline")},e.toDisplayString(t.status?"åœ¨çº¿":"ç¦»çº¿"),3),(e.openBlock(),e.createElementBlock("text",{key:0,class:"status-noauth"},e.toDisplayString(t.account&&t.password?"éœ€è®¤è¯":"å…è®¤è¯"),1))]),h.value===n?(e.openBlock(),e.createElementBlock("view",{key:0,class:"selected-indicator"},[e.createVNode(o,{type:"checkmark",size:"16",color:"#4361ee"})])):e.createCommentVNode("",!0)])],10,["onClick"])))),128)),0===v.value.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},[e.createElementVNode("text",null,"æš‚æ— èŠ‚ç‚¹æ•°æ®ï¼Œè¯·å…ˆç™»å½•æˆ–åˆ·æ–°")])):e.createCommentVNode("",!0)])]),e.createElementVNode("view",{class:"section tips-section"},[e.createElementVNode("view",{class:"section-header"},[e.createElementVNode("text",{class:"section-title"},"ä½¿ç”¨æç¤º")]),e.createElementVNode("view",{class:"tips-content"},[e.createElementVNode("text",{class:"tip-item"},"â€¢ èŠ‚ç‚¹â€œå…è®¤è¯â€è¯´æ˜å¯ç›´æ¥è¿æ¥ï¼ˆSOCKS5 æ— è®¤è¯ï¼‰"),e.createElementVNode("text",{class:"tip-item"},"â€¢ é¦–æ¬¡è¿æ¥ä¼šå¼¹å‡º VPN è®¸å¯å¯¹è¯æ¡†ï¼Œè¯·å…è®¸"),e.createElementVNode("text",{class:"tip-item"},"â€¢ è¿æ¥åå¯åˆ‡åˆ°åå°ï¼ŒæœåŠ¡ä¼šå¸¸é©»")])])])}}},[["__scopeId","data-v-753f7bb7"]]),u=i({__name:"login",setup(t){const n=e.ref("test_pan_1234"),a=e.ref("123456"),s=async()=>{var e;if(!n.value||!a.value)return uni.showToast({title:"è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ",icon:"none"});uni.showLoading({title:"ç™»å½•ä¸­..."});try{const t=await uni.request({url:"http://124.223.21.69/api/users/login",method:"POST",data:{username:n.value,password:a.value},header:{"Content-Type":"application/json"}});if(200!==t.statusCode||!t.data)throw new Error((null==(e=t.data)?void 0:e.message)||"ç™»å½•å¤±è´¥");{const e=t.data.token||t.data.accessToken;if(!e)throw new Error("æœªè¿”å› token");uni.setStorageSync("token",e),uni.setStorageSync("username",n.value),uni.showToast({title:"ç™»å½•æˆåŠŸ",icon:"success"}),setTimeout((()=>{uni.reLaunch({url:"/pages/index/index"})}),500)}}catch(t){uni.showToast({title:t.message||"ç™»å½•å¤±è´¥",icon:"none"})}finally{uni.hideLoading()}};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"login-container"},[e.createElementVNode("view",{class:"login-header"},[e.createElementVNode("view",{class:"title-container"},[e.createElementVNode("image",{class:"title-icon",src:"/static/icon.ico",mode:"aspectFit"}),e.createElementVNode("text",{class:"login-title"},"eåŠ é€Ÿ")]),e.createElementVNode("text",{class:"login-subtitle"},"è¯·ç™»å½•æ‚¨çš„VPNè´¦æˆ·")]),e.createElementVNode("view",{class:"login-form"},[e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("text",{class:"input-label"},"ç”¨æˆ·å"),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>n.value=e),placeholder:"è¯·è¾“å…¥ç”¨æˆ·å"},null,512),[[e.vModelText,n.value]])]),e.createElementVNode("view",{class:"input-group"},[e.createElementVNode("text",{class:"input-label"},"å¯†ç "),e.withDirectives(e.createElementVNode("input",{class:"input-field",type:"password","onUpdate:modelValue":o[1]||(o[1]=e=>a.value=e),placeholder:"è¯·è¾“å…¥å¯†ç "},null,512),[[e.vModelText,a.value]])]),e.createElementVNode("button",{class:"btn-login",onClick:s},"ç™»å½•"),e.createElementVNode("view",{class:"login-tips"})])]))}},[["__scopeId","data-v-3697e022"]]);__definePage("pages/index/index",r),__definePage("pages/login/login",u);const d={__name:"App",setup:e=>(o((()=>{n("log","at App.vue:6","App Launch");uni.getStorageSync("token")&&uni.reLaunch({url:"/pages/index/index"})})),n("log","at App.vue:18","App Show"),s((()=>{n("log","at App.vue:22","App Hide")})),()=>{})};const{app:p,Vuex:m,Pinia:v}={app:e.createVueApp(d)};uni.Vuex=m,uni.Pinia=v,p.provide("__globalStyles",__uniConfig.styles),p._component.mpType="app",p._component.render=()=>{},p.mount("#app")}(Vue);
